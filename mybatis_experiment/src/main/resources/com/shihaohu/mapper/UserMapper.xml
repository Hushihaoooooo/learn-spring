<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shihaohu.mapper.xml.UserMapper">
    <!--由于已经启动了驼峰下划线转换，该resultMap只是写出，未使用-->
    <resultMap id="userMap" type="com.shihaohu.pojo.User">
        <result property="registTime" column="regist_time"/>
        <result property="userName" column="user_name"/>
    </resultMap>

    <select id="getBigv" resultType="com.shihaohu.pojo.User">
        SELECT *
        FROM user
                 JOIN picture ON user.id = picture.user_id
        WHERE picture.click_num = (
            SELECT MAX(click_num) FROM picture
        );
    </select>
    <select id="getUserPictures" resultType="com.shihaohu.pojo.Picture">
        SELECT *
        FROM picture
        WHERE user_id = #{userId}
        LIMIT #{pageNo}, #{pageSize};
    </select>
    <select id="getUserPictures2" resultType="com.shihaohu.pojo.Picture">
        SELECT *
        FROM picture
        WHERE user_id = #{userId}
        <if test="startTime != null">
            and upload_time >= #{startTime}
        </if>
        <if test="endTime != null">
            and upload_time <![CDATA[
                <=
            ]]> #{endTime}
        </if>
        LIMIT #{pageNo}, #{pageSize};
    </select>
    <select id="getFollows" resultType="com.shihaohu.pojo.User">
        select *
        from user
        where id in (
            select concerned_id
            from concern
            where concerner_id = #{userId}
            );

    </select>
    <select id="getFollowPictures" resultType="com.shihaohu.pojo.Picture">
        select *
        from picture
        where picture.user_id in (select concerned_id
                     from concern
                     where concerner_id = #{userId});
    </select>
    <select id="getFollowPictures2" resultType="com.shihaohu.pojo.Picture">
        select *
        from picture
        where picture.user_id in (select concerned_id
        from concern
        where concerner_id = #{userId})
        <if test="startTime != null">
            and upload_time >= #{startTime}
        </if>
        <if test="endTime != null">
            and upload_time <![CDATA[
                <=
            ]]> #{endTime}
        </if>
        LIMIT #{pageNo}, #{pageSize};
    </select>
    <select id="getRecentPictures" resultType="com.shihaohu.pojo.Picture">
        select *
        from picture
        order by upload_time desc
        LIMIT #{pageNo}, #{pageSize};
    </select>
    <select id="findUsersByName" resultType="com.shihaohu.pojo.User">
        select *
        from user
        where user_name like #{userName};
    </select>
    <select id="findPicturesByName" resultType="com.shihaohu.pojo.Picture">
        select *
        from picture
        where name like #{pictureName};
    </select>
    <select id="findPicturesByTags" resultType="com.shihaohu.pojo.Picture">
        select *
        from picture
        where tags = #{tags};
    </select>
</mapper>
